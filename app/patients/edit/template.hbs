<div class="panel-group" id="patient-accordion">
    <div class="panel detail-section">
        <div class="panel-heading">
            <h3 class="panel-title">
                <a data-toggle="collapse" data-parent="#patient-accordion" href="#patient-demo">
                    General Information
                </a>
            </h3>
        </div>
        <div id="patient-demo" class="panel-collapse collapse in">
            <div class="panel-body detail-section-content detail-section-content">
                {{#em-form model=this submit_button=false }}
                    <div class="row">
                        <div class="col-xs-12 col-sm-6">
                            <div class="form-group has-success">
                                <label class="control-label">Record Number</label>
                                <div class="form-control not-editable">
                                    {{id}}
                                </div>
                            </div>
                            {{em-input property="firstName" label="First Name"}}
                            {{em-input property="lastName" label="Last Name"}}
                            <div class="form-group">
                                <label>Gender:</label>  
                                <div class="row">
                                    <div class="col-xs-1"></div>
                                    {{ext-radio name=gender content=genderList value=gender class="col-xs-4"}}
                                </div>
                            </div>
                            {{date-picker property="dateOfBirth" label="Date of Birth" maxDate="now"}}
                            <div class="form-group">
                                <label class="control-label">Age</label>
                                <p class="form-control-static">{{dobInDays}}</p>
                            </div>
                            {{em-input property="placeOfBirth" label="Place of Birth"}}
                        </div>
                        <div class="col-xs-12 col-sm-6">
                            {{em-select
                                prompt=" "
                                label="Blood Type"
                                property="bloodType"
                                content=bloodTypes
                                optionValuePath="content"
                                optionLabelPath="content"
                            }}
                            {{select-or-typeahead property="clinic" label="Clinic Site" list=clinicList selection=clinic }}
                            {{em-input property="referredBy" label="Referred By"}}
                            {{em-input property="religion" label="Religion"}}                            
                            {{em-input property="phone" label="Phone Contact"}}
                            {{em-input property="email" type="email" label="Email"}}
                            {{em-input property="parent" label="Parent/Guardian"}}                            
                        </div>
                    </div>
                    <div class="row">                        
                        {{#if haveAddressOptions}}
                            {{#if address1Include}}
                                {{em-text label=address1Label property="address" rows=3 class="col-xs-12 col-sm-6"}}
                            {{/if}}                                
                            {{#if address2Include}}
                                {{em-input label=address2Label property="address2" class="col-xs-12 col-sm-6" }}
                            {{/if}}
                            {{#if address3Include}}
                                {{em-input label=address3Label property="address3" class="col-xs-12 col-sm-6" }}
                            {{/if}}
                            {{#if address4Include}}
                                {{em-input label=address4Label property="address4" class="col-xs-12 col-sm-6" }}
                            {{/if}}                            
                        {{else}}
                            {{em-text label="Address" property="address" rows=3  class="col-xs-12 col-sm-6"}}
                        {{/if}}
                        {{select-or-typeahead property="country" label="Country" list=countryList selection=country class="col-xs-12 col-sm-6" }}
                    </div>
                        
                {{/em-form}}
            </div>
        </div>
    </div>
    <div class="panel">    
        <div class="panel-heading">
            <h3 class="panel-title">
                <a data-toggle="collapse" data-parent="#patient-accordion" href="#patient-photos">
                    Photos
                    {{#if canAddPhoto}}
                        <button class="btn btn-primary align-right" {{action "showAddPhoto" bubbles=false }}><span class="octicon octicon-plus"></span>New Photo</button>
                    {{/if}}
                </a>
            </h3>
        </div>
        <div id="patient-photos" class="panel-collapse collapse in">
            <div class="panel-body detail-section-content detail-section-content">
                <div class="row">
                    {{#each photos itemController="patients/photo-item"}}
                        <div class="col-sm-4 col-md-3">                                
                             <div {{action "editPhoto" this}} class="thumbnail">
                                <img {{bind-attr alt="caption" src="photoUrl"}} class="img-responsive" >
                                <div class="caption">
                                    {{caption}}
                                    <p>
                                        {{#if parentController.canAddPhoto}}
                                            <button class="btn btn-default neutral" {{action "editPhoto" this}}>Edit</button>
                                        {{/if}}
                                        {{#if parentController.canDeletePhoto}}
                                            <button class="btn btn-default warning" {{action "showDeletePhoto" this bubbles=false }}><span class="octicon octicon-x"></span>Delete</button>
                                        {{/if}}
                                    </p>
                                </div>
                            </div>
                        </div>
                    {{/each}}
                </div>
            </div>
        </div>
    </div>
    <div class="panel">    
        <div class="panel-heading">
            <h3 class="panel-title">
                <a data-toggle="collapse" data-parent="#patient-accordion" href="#patient-diagnoses">
                    Diagnoses
                </a>
            </h3>
        </div>
        <div id="patient-diagnoses" class="panel-collapse collapse in">
            <div class="panel-body detail-section-content">
                <table class="table">
                    <tr class="table-header">
                        <th>Date</th>
                        <th>Diagnosis</th>
                        <th>Primary Diagnosis</th>
                    </tr>
                    {{#each patientDiagnoses}}
                        <tr>
                            <td>{{date-format date}}</td>
                            <td>{{description}}</td>
                            <td>{{#if primary}}
                                    Y
                                {{else}}
                                    N
                                {{/if}}                                
                            </td>
                        </tr>
                    {{/each}}
                </table>
            </div>
        </div>
    </div>
    <div class="panel">    
        <div class="panel-heading">
            <h3 class="panel-title">
                <a data-toggle="collapse" data-parent="#patient-accordion" href="#patient-procedures">
                    Procedures
                </a>
            </h3>
        </div>
        <div id="patient-procedures" class="panel-collapse collapse in">
            <div class="panel-body detail-section-content">
                <table class="table">
                    <tr class="table-header">
                        <th>Date</th>
                        <th>Procedure</th>
                        <th>Physician</th>
                        <th>Assistant</th>
                    </tr>
                    {{#each patientProcedures}}
                        <tr>
                            <td>{{date-format procedureDate}}</td>
                            <td>{{description}}</td>
                            <td>{{physician}}</td>
                            <td>{{assistant}}</td>
                        </tr>
                    {{/each}}
                </table>
            </div>
        </div>
    </div>    
    <div class="panel">
        <div class="panel-heading">
            <h3 class="panel-title">
                <a data-toggle="collapse" data-parent="#patient-accordion" href="#patient-medication">
                    Medication
                    {{#if canAddMedication}}
                        <button class="btn btn-primary align-right" {{action "newMedication" bubbles=false }}><span class="octicon octicon-plus"></span>New Medication</button>
                    {{/if}}
                </a>
            </h3>
        </div>
        <div id="patient-medication" class="panel-collapse collapse in">
            <div class="panel-body detail-section-content">
                <table class="table">
                    <tr class="table-header">
                        <th>Date</th>
                        <th>Name</th>
                        <th>Status</th>
                        <th>Prescription</th>
                        <th>Requested By</th>
                        <th>Actions</th>
                    </tr>
                    {{#each patientMedications itemController="medication/item-controller"}}
                        <tr {{action "editMedication" this}}>
                            <td>{{date-format prescriptionDate}}</td>
                            <td>{{inventoryItem.name}}</td>
                            <td>{{status}}</td>
                            <td>{{prescription}}</td>
                            <td>{{requestedBy}}</td>
                            <td>
                                {{#if canEdit}}
                                    {{#if parentController.canAddMedication}}
                                        <button class="btn btn-default neutral" {{action "editMedication" this}}>Edit</button>
                                    {{/if}}
                                    {{#if parentController.canDeleteMedication}}
                                        <button class="btn btn-default warning" {{action "showDeleteMedication" this  bubbles=false }}><span class="octicon octicon-x"></span>Delete</button>
                                    {{/if}}
                                {{/if}}
                            </td>
                        </tr>
                    {{/each}}
                </table>
            </div>
        </div>
    </div>
    <div class="panel">
        <div class="panel-heading">
            <h3 class="panel-title">
                <a data-toggle="collapse" data-parent="#patient-accordion" href="#patient-labs">
                    Labs
                    {{#if canAddLab}}
                        <button class="btn btn-primary align-right" {{action "newLab" bubbles=false }}><span class="octicon octicon-plus"></span> New Lab</button>
                    {{/if}}
                </a>
            </h3>
        </div>
        <div id="patient-labs" class="panel-collapse collapse in">
            <div class="panel-body detail-section-content">
                <table class="table">
                    <tr class="table-header">
                        <th>Date Requested</th>
                        <th>Lab Type</th>
                        <th>Status</th>
                        <th>Date Processed</th>
                        <th>Result</th>
                        <th>Notes</th>
                        <th>Requested By</th>
                        <th>Actions</th>
                    </tr>
                    {{#each patientLabs itemController="labs/item-controller"}}
                        <tr {{action "editLab" this}}>
                            <td>{{date-format requestedDate}}</td>
                            <td>{{labType}}</td>
                            <td>{{status}}</td>
                            <td>{{date-format labDate}}</td>
                            <td>{{result}}</td>
                            <td>{{notes}}</td>
                            <td>{{requestedBy}}</td>
                            <td>
                                {{#if canEdit}}
                                    {{#if parentController.canAddLab}}
                                        <button class="btn btn-default neutral" {{action "editLab" this}}>Edit</button>
                                    {{/if}}
                                    {{#if parentController.canDeleteLab}}
                                        <button class="btn btn-default warning" {{action "showDeleteLab" this  bubbles=false }}><span class="octicon octicon-x"></span> Delete</button>
                                    {{/if}}
                                {{/if}}
                            </td>
                        </tr>
                    {{/each}}
                </table>
            </div>
        </div>
    </div>
    <div class="panel">
        <div class="panel-heading">
            <h3 class="panel-title">
                <a data-toggle="collapse" data-parent="#patient-accordion" href="#patient-imaging">
                    Imaging
                    {{#if canAddImaging}}
                        <button class="btn btn-primary align-right" {{action "newImaging" bubbles=false }}><span class="octicon octicon-plus"></span> New Imaging</button>
                    {{/if}}
                </a>
            </h3>
        </div>
        <div id="patient-imaging" class="panel-collapse collapse in">
            <div class="panel-body detail-section-content">
                <table class="table">
                    <tr class="table-header">
                        <th>Date Requested</th>
                        <th>Imaging Type</th>
                        <th>Status</th>
                        <th>Date Processed</th>
                        <th>Result</th>
                        <th>Notes</th>
                        <th>Requested By</th>
                        <th>Actions</th>
                    </tr>
                    {{#each patientImaging itemController="imaging/item-controller"}}
                        <tr {{action "editImaging" this}}>
                            <td>{{date-format requestedDate}}</td>
                            <td>{{imagingType}}</td>
                            <td>{{status}}</td>
                            <td>{{date-format imagingDate}}</td>
                            <td>{{result}}</td>
                            <td>{{notes}}</td>
                            <td>{{requestedBy}}</td>
                            <td>
                                {{#if canEdit}}
                                    {{#if parentController.canAddImaging}}
                                        <button class="btn btn-default neutral" {{action "editImaging" this}}>Edit</button>
                                    {{/if}}
                                    {{#if parentController.canDeleteImaging}}
                                        <button class="btn btn-default warning" {{action "showDeleteImaging" this  bubbles=false }}><span class="octicon octicon-x"></span> Delete</button>
                                    {{/if}}
                                {{/if}}
                            </td>
                        </tr>
                    {{/each}}
                </table>
            </div>
        </div>
    </div>
    <div class="panel">
        <div class="panel-heading">
            <h3 class="panel-title">
                <a data-toggle="collapse" data-parent="#patient-accordion" href="#patient-visits">
                    Visits
                    {{#if canAddVisit}}
                        <button class="btn btn-primary align-right" {{action "newVisit" bubbles=false }}><span class="octicon octicon-plus"></span> New Visit</button>
                    {{/if}}
                </a>
            </h3>
        </div>
        <div id="patient-visits" class="panel-collapse collapse in">
            <div class="panel-body detail-section-content">
                <table class="table" >
                    <tr class="table-header">
                        <th>Start Date</th>
                        <th>End Date</th>
                        <th>Diagnosis</th>
                        <th>Provider</th>
                        <th>Location</th>
                        <th>Type</th>
                        <th>Actions</th>
                    </tr>
                    {{#with this as patientController}}
                        {{#each visits}}
                            <tr {{action "editVisit" this}}>
                                <td>{{date-format startDate}}</td>
                                <td>{{date-format endDate}}</td>
                                <td>{{primaryDiagnosis}}</td>
                                <td>{{examiner}}</td>
                                <td>{{location}}</td>
                                <td>{{visitType}}</td>
                                <td>
                                    {{#if patientController.canAddVisit}}
                                        <button class="btn btn-default neutral" {{action "editVisit" this}}>Edit</button>
                                    {{/if}}
                                    {{#if patientController.canDeleteVisit}}
                                        <button class="btn btn-default warning" {{action "showDeleteVisit" this bubbles=false }}><span class="octicon octicon-x"></span> Delete</button>
                                    {{/if}}
                                </td>
                            </tr>
                        {{/each}}
                    {{/with}}
                </table>
            </div>
        </div>
    </div>
    <div class="panel">
        <div class="panel-heading">
            <h3 class="panel-title">
                <a data-toggle="collapse" data-parent="#patient-accordion" href="#patient-appointments">
                    Appointments
                    {{#if canAddAppointment}}
                        <button class="btn btn-primary align-right" {{action "newAppointment" bubbles=false }}><span class="octicon octicon-plus"></span> New Appointment</button>
                    {{/if}}
                </a>
            </h3>
        </div>
        <div id="patient-appointments" class="panel-collapse collapse in">
            <div class="panel-body detail-section-content">
                <table class="table">
                    <tr class="table-header">
                        <th>Date</th>
                        <th>Examiner</th>
                        <th>Location</th>
                        <th>Type</th>
                        <th>Actions</th>
                    </tr>
                    {{#with this as patientController}}
                        {{#each appointments itemController='appointments/item'}}
                            <tr {{action "editAppointment" this}}>
                                <td>{{appointmentDate}}</td>
                                <td>{{provider}}</td>
                                <td>{{location}}</td>
                                <td>{{appointmentType}}</td>
                                <td>
                                    {{#if patientController.canAddAppointment}}
                                        <button class="btn btn-default neutral" {{action "editAppointment" this}}>Edit</button>
                                    {{/if}}
                                    {{#if patientController.canDeleteAppointment}}
                                        <button class="btn btn-default warning" {{action "showDeleteAppointment" this  bubbles=false }}><span class="octicon octicon-x"></span> Delete</button>
                                    {{/if}}
                                </td>
                            </tr>
                        {{/each}}
                    {{/with}}
                </table>
            </div>
        </div>
    </div>

</div>